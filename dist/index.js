var e,t=require("react"),r=require("recoil"),n=(e=require("immer"))&&"object"==typeof e&&"default"in e?e.default:e,i=require("firebase/app");function o(e){return n({firebaseUser:void 0,loading:!0},function(t){Object.assign(t,e)})}require("firebase/auth");var u=r.atom({key:"authenticationAtom",default:o(),dangerouslyAllowMutability:!0}),s=r.atom({key:"usersAtom",default:new Map});function a(){var e=r.useRecoilValue(s),t=r.useRecoilValue(u);if(null!=t.firebaseUser&&e.has(t.firebaseUser.uid))return e.get(t.firebaseUser.uid)}function c(e){return i.auth().onAuthStateChanged(function(t){e(o({firebaseUser:t,loading:!1}))},function(e){alert(e.message)})}function l(e,t,r){return e.collections.users.subscribeToDocument(t,function(e){r&&r(e)},function(e){alert(e.message)},function(){r&&r()})}exports.Authenticate=function(e){var n=r.useRecoilState(u),i=n[0],o=n[1],f=r.useSetRecoilState(s),d=a(),m=t.useState(!0),p=m[0],h=m[1],b=e.database;return t.useEffect(function(){var e=c(function(e){o(e)});return function(){e()}},[o]),t.useEffect(function(){var e;return null!=i.firebaseUser&&(e=l(b,i.firebaseUser.uid,function(e){null!=e&&f(function(t){return t.set(e.id(),e)}),h(!1)})),function(){e&&e()}},[i,b,f]),void 0===i.firebaseUser&&i.loading?e.loadingComponent:null===i.firebaseUser&&!1===i.loading?e.authenticationComponent:p&&null==d?e.loadingComponent:null==d?e.userNotAvailableComponent:e.children},exports.FirebaseInit=function(e){var r=t.useState(!1),n=r[0],o=r[1],u=e.firebaseConfig;return t.useLayoutEffect(function(){i.initializeApp(u),o(!0)},[u]),n?e.children:e.loadingComponent},exports.authenticationAtom=u,exports.createAuthenticationState=o,exports.createUser=function(e,t){try{return Promise.resolve(e.collections.users.createDocument(t))}catch(e){return Promise.reject(e)}},exports.isAuthenticationState=function(e){return null!=e.loading},exports.isMinimalExpectedDatabase=function(e){return null!=e.collections.users},exports.isMinimalUserData=function(e){return null!=e.email},exports.signIn=function(e,t){try{return Promise.resolve(i.auth().signInWithEmailAndPassword(e,t)).then(function(e){return o({firebaseUser:e.user,loading:!1})})}catch(e){return Promise.reject(e)}},exports.signOut=function(){try{return Promise.resolve(i.auth().signOut()).then(function(){return o({loading:!1})})}catch(e){return Promise.reject(e)}},exports.signUp=function(e,t){try{return Promise.resolve(i.auth().createUserWithEmailAndPassword(e,t)).then(function(e){return o({firebaseUser:e.user,loading:!1})})}catch(e){return Promise.reject(e)}},exports.subscribeForAuthenticatedUser=c,exports.subscribeForUser=l,exports.updateUser=function(e,t){try{return Promise.resolve(e.collections.users.updateDocument(t))}catch(e){return Promise.reject(e)}},exports.useAuthenticatedUser=a,exports.usersAtom=s;
//# sourceMappingURL=index.js.map
