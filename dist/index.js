function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var t=require("recoil"),r=e(require("immer")),n=require("react"),i=e(n),u=require("firebase/app");function o(e){return r({firebaseUser:void 0,loading:!0},function(t){Object.assign(t,e)})}require("firebase/auth");var s=t.atom({key:"authenticationAtom",default:o(),dangerouslyAllowMutability:!0}),a=t.atom({key:"usersAtom",default:new Map});function c(e){return u.auth().onAuthStateChanged(function(t){e(o({firebaseUser:t,loading:!1}))},function(e){alert(e.message)})}function l(){var e=t.useRecoilState(s),r=e[0],i=e[1];return n.useEffect(function(){var e=c(function(e){i(e)});return function(){e()}},[i]),r}function f(e,t,r){return e.collections.users.subscribeToDocument(t,function(e){r&&r(e)},function(e){alert(e.message)},function(){r&&r()})}function d(e,r){var i=t.useSetRecoilState(a),u=n.useState(!0),o=u[0],s=u[1];return n.useEffect(function(){var t;return null!=e.firebaseUser&&(t=f(r,e.firebaseUser.uid,function(e){null!=e&&i(function(t){return t.set(e.id(),e)}),s(!1)})),function(){t&&t()}},[e,r,i]),o}function m(){var e=t.useRecoilValue(a),r=t.useRecoilValue(s);if(null!=r.firebaseUser&&e.has(r.firebaseUser.uid))return e.get(r.firebaseUser.uid)}var b=i.createContext(void 0);exports.Authenticate=function(e){var t=e.database,r=l(),n=d(r,t),i=m();return void 0===r.firebaseUser&&r.loading?e.loadingComponent:null===r.firebaseUser&&!1===r.loading?e.authenticationComponent:n&&null==i?e.loadingComponent:null==i?e.userNotAvailableComponent:e.children},exports.FirebaseInit=function(e){var t=n.useState(void 0),r=t[0],o=t[1],s=e.firebaseConfig;return n.useLayoutEffect(function(){o(u.initializeApp(s))},[s]),i.createElement(b.Provider,{value:r},null!=r?e.children:e.loadingComponent)},exports.authenticationAtom=s,exports.createAuthenticationState=o,exports.createUser=function(e,t){try{return Promise.resolve(e.collections.users.createDocument(t))}catch(e){return Promise.reject(e)}},exports.isAuthenticationState=function(e){return null!=e.loading},exports.isMinimalExpectedDatabase=function(e){return null!=e.collections.users},exports.isMinimalUserData=function(e){return null!=e.email},exports.signIn=function(e,t){try{return Promise.resolve(u.auth().signInWithEmailAndPassword(e,t)).then(function(e){return o({firebaseUser:e.user,loading:!1})})}catch(e){return Promise.reject(e)}},exports.signOut=function(){try{return Promise.resolve(u.auth().signOut()).then(function(){return o({loading:!1})})}catch(e){return Promise.reject(e)}},exports.signUp=function(e,t){try{return Promise.resolve(u.auth().createUserWithEmailAndPassword(e,t)).then(function(e){return o({firebaseUser:e.user,loading:!1})})}catch(e){return Promise.reject(e)}},exports.subscribeForAuthenticatedUser=c,exports.subscribeForUser=f,exports.updateUser=function(e,t){try{return Promise.resolve(e.collections.users.updateDocument(t))}catch(e){return Promise.reject(e)}},exports.useAuthenticatedUser=m,exports.useSubscribeForAuthenticatedUser=l,exports.useSubscribeForDatabaseUserObject=d,exports.usersAtom=a;
//# sourceMappingURL=index.js.map
