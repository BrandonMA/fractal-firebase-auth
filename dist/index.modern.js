import{useState as e,useEffect as n,useLayoutEffect as r}from"react";import{atom as t,useRecoilValue as i,useRecoilState as o,useSetRecoilState as u}from"recoil";import s from"immer";import{auth as a,initializeApp as c}from"firebase/app";import"firebase/auth";function l(e){return s({firebaseUser:void 0,loading:!0},function(n){Object.assign(n,e)})}function f(e){return null!=e.loading}function m(e){return null!=e.email}function d(e){return null!=e.collections.users}var b=t({key:"authenticationAtom",default:l(),dangerouslyAllowMutability:!0}),g=t({key:"usersAtom",default:new Map});function h(){var e=i(g),n=i(b);if(null!=n.firebaseUser&&e.has(n.firebaseUser.uid))return e.get(n.firebaseUser.uid)}function p(e){return a().onAuthStateChanged(function(n){e(l({firebaseUser:n,loading:!1}))},function(e){alert(e.message)})}function v(e,n,r){return e.collections.users.subscribeToDocument(n,function(e){r&&r(e)},function(e){alert(e.message)},function(){r&&r()})}function P(r){var t=o(b),i=t[0],s=t[1],a=u(g),c=h(),l=e(!0),f=l[0],m=l[1],d=r.database;return n(function(){var e=p(function(e){s(e)});return function(){e()}},[s]),n(function(){var e;return null!=i.firebaseUser&&(e=v(d,i.firebaseUser.uid,function(e){null!=e&&a(function(n){return n.set(e.id(),e)}),m(!1)})),function(){e&&e()}},[i,d,a]),void 0===i.firebaseUser&&i.loading?r.loadingComponent:null===i.firebaseUser&&!1===i.loading?r.authenticationComponent:f&&null==c?r.loadingComponent:null==c?r.userNotAvailableComponent:r.children}function U(n){var t=e(!1),i=t[0],o=t[1],u=n.firebaseConfig;return r(function(){c(u),o(!0)},[u]),i?n.children:n.loadingComponent}var y=function(e,n){try{return Promise.resolve(a().signInWithEmailAndPassword(e,n)).then(function(e){return l({firebaseUser:e.user,loading:!1})})}catch(e){return Promise.reject(e)}},A=function(){try{return Promise.resolve(a().signOut()).then(function(){return l({loading:!1})})}catch(e){return Promise.reject(e)}},C=function(e,n){try{return Promise.resolve(a().createUserWithEmailAndPassword(e,n)).then(function(e){return l({firebaseUser:e.user,loading:!1})})}catch(e){return Promise.reject(e)}},j=function(e,n){try{return Promise.resolve(e.collections.users.createDocument(n))}catch(e){return Promise.reject(e)}},w=function(e,n){try{return Promise.resolve(e.collections.users.updateDocument(n))}catch(e){return Promise.reject(e)}};export{P as Authenticate,U as FirebaseInit,b as authenticationAtom,l as createAuthenticationState,j as createUser,f as isAuthenticationState,d as isMinimalExpectedDatabase,m as isMinimalUserData,y as signIn,A as signOut,C as signUp,p as subscribeForAuthenticatedUser,v as subscribeForUser,w as updateUser,h as useAuthenticatedUser,g as usersAtom};
//# sourceMappingURL=index.modern.js.map
