import{useState as e,useEffect as n}from"react";import{atom as r,selector as t,useRecoilState as i,useSetRecoilState as o,useRecoilValue as u}from"recoil";import s from"immer";import{auth as a,initializeApp as c}from"firebase/app";import"firebase/auth";function l(e){return s({firebaseUser:void 0,loading:!0},function(n){Object.assign(n,e)})}function f(e){return null!=e.loading}function m(e){return null!=e.email}function d(e){return null!=e.collections.users}var g=r({key:"authenticationAtom",default:l()}),b=r({key:"usersAtom",default:new Map}),h=t({key:"currentUserSelector",get:function(e){var n=e.get,r=n(g),t=n(b);if(null!=r.firebaseUser)return t.get(r.firebaseUser.uid)}});function p(e){return a().onAuthStateChanged(function(n){e(l({firebaseUser:n,loading:!1}))},function(e){alert(e.message)})}function v(r){var t=i(g),s=t[0],a=t[1],c=o(b),l=u(h),f=e(!0),m=f[0],d=f[1],v=r.database;return n(function(){var e=p(function(e){a(e)});return function(){e()}},[a]),n(function(){var e;return null!=s.firebaseUser&&(e=function(e,n,r){return e.collections.users.subscribeToDocument(n,function(e){r&&r(e)},function(e){alert(e.message)},function(){r&&r()})}(v,s.firebaseUser.uid,function(e){null!=e&&c(function(n){return n.set(e.id(),e)}),d(!1)})),function(){e&&e()}},[s,v,c]),void 0===s.firebaseUser&&s.loading?r.loadingComponent:null===s.firebaseUser&&!1===s.loading?r.authenticationComponent:m&&null==l?r.loadingComponent:null==l?r.userNotAvailableComponent:r.children}function U(r){var t=e(!1),i=t[0],o=t[1],u=r.firebaseConfig;return n(function(){c(u),o(!0)},[u]),i?r.children:r.loadingComponent}var P=function(e,n){try{return Promise.resolve(a().signInWithEmailAndPassword(e,n)).then(function(e){return l({firebaseUser:e.user,loading:!1})})}catch(e){return Promise.reject(e)}},y=function(){try{return Promise.resolve(a().signOut()).then(function(){return l({loading:!1})})}catch(e){return Promise.reject(e)}},C=function(e,n){try{return Promise.resolve(a().createUserWithEmailAndPassword(e,n)).then(function(e){return l({firebaseUser:e.user,loading:!1})})}catch(e){return Promise.reject(e)}},A=function(e,n){try{return Promise.resolve(e.collections.users.createDocument(n))}catch(e){return Promise.reject(e)}};export{v as Authenticate,U as FirebaseInit,g as authenticationAtom,l as createAuthenticationState,A as createUser,h as currentUserSelector,f as isAuthenticationState,d as isMinimalExpectedDatabase,m as isMinimalUserData,P as signIn,y as signOut,C as signUp,p as subscribeForAuthenticatedUser,b as usersAtom};
//# sourceMappingURL=index.modern.js.map
