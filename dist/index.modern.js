import{atom as e,useRecoilState as n,useSetRecoilState as r,useRecoilValue as t}from"recoil";import o from"immer";import i,{useEffect as u,useState as s,useLayoutEffect as a}from"react";import{auth as c,initializeApp as l}from"firebase/app";import"firebase/auth";function f(e){return o({firebaseUser:void 0,loading:!0},function(n){Object.assign(n,e)})}function m(e){return null!=e.loading}function d(e){return null!=e.email}function v(e){return null!=e.collections.users}var b=e({key:"authenticationAtom",default:f(),dangerouslyAllowMutability:!0}),g=e({key:"usersAtom",default:new Map});function p(e){return c().onAuthStateChanged(function(n){e(f({firebaseUser:n,loading:!1}))},function(e){alert(e.message)})}function P(){var e=n(b),r=e[0],t=e[1];return u(function(){var e=p(function(e){t(e)});return function(){e()}},[t]),r}function U(e,n,r){return e.collections.users.subscribeToDocument(n,function(e){r&&r(e)},function(e){alert(e.message)},function(){r&&r()})}function y(e,n){var t=r(g),o=s(!0),i=o[0],a=o[1];return u(function(){var r;return null!=e.firebaseUser&&(r=U(n,e.firebaseUser.uid,function(e){null!=e&&t(function(n){return n.set(e.id(),e)}),a(!1)})),function(){r&&r()}},[e,n,t]),i}function C(){var e=t(g),n=t(b);if(null!=n.firebaseUser&&e.has(n.firebaseUser.uid))return e.get(n.firebaseUser.uid)}function A(e){var n=e.database,r=P(),t=y(r,n),o=C();return void 0===r.firebaseUser&&r.loading?e.loadingComponent:null===r.firebaseUser&&!1===r.loading?e.authenticationComponent:t&&null==o?e.loadingComponent:null==o?e.userNotAvailableComponent:e.children}var j=i.createContext(void 0);function w(e){var n=s(void 0),r=n[0],t=n[1],o=e.firebaseConfig;return a(function(){t(l(o))},[o]),h(j.Provider,{value:r},null!=r?e.children:e.loadingComponent)}var D=function(e,n){try{return Promise.resolve(c().signInWithEmailAndPassword(e,n)).then(function(e){return f({firebaseUser:e.user,loading:!1})})}catch(e){return Promise.reject(e)}},k=function(){try{return Promise.resolve(c().signOut()).then(function(){return f({loading:!1})})}catch(e){return Promise.reject(e)}},x=function(e,n){try{return Promise.resolve(c().createUserWithEmailAndPassword(e,n)).then(function(e){return f({firebaseUser:e.user,loading:!1})})}catch(e){return Promise.reject(e)}},E=function(e,n){try{return Promise.resolve(e.collections.users.createDocument(n))}catch(e){return Promise.reject(e)}},M=function(e,n){try{return Promise.resolve(e.collections.users.updateDocument(n))}catch(e){return Promise.reject(e)}};export{A as Authenticate,w as FirebaseInit,b as authenticationAtom,f as createAuthenticationState,E as createUser,m as isAuthenticationState,v as isMinimalExpectedDatabase,d as isMinimalUserData,D as signIn,k as signOut,x as signUp,p as subscribeForAuthenticatedUser,U as subscribeForUser,M as updateUser,C as useAuthenticatedUser,P as useSubscribeForAuthenticatedUser,y as useSubscribeForDatabaseUserObject,g as usersAtom};
//# sourceMappingURL=index.modern.js.map
