!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("recoil"),require("immer"),require("react"),require("firebase/app"),require("firebase/auth")):"function"==typeof define&&define.amd?define(["exports","recoil","immer","react","firebase/app","firebase/auth"],t):t((e=e||self).reactFirebaseAuth={},e.recoil,e.immer,e.react,e.firebase)}(this,function(e,t,r,n,i){r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r;var u="default"in n?n.default:n;function o(e){return r({firebaseUser:void 0,loading:!0},function(t){Object.assign(t,e)})}var a=t.atom({key:"authenticationAtom",default:o(),dangerouslyAllowMutability:!0}),s=t.atom({key:"usersAtom",default:new Map});function c(e){return i.auth().onAuthStateChanged(function(t){e(o({firebaseUser:t,loading:!1}))},function(e){alert(e.message)})}function l(){var e=t.useRecoilState(a),r=e[0],i=e[1];return n.useEffect(function(){var e=c(function(e){i(e)});return function(){e()}},[i]),r}function f(e,t,r){return e.collections.users.subscribeToDocument(t,function(e){r&&r(e)},function(e){alert(e.message)},function(){r&&r()})}function d(e,r){var i=t.useSetRecoilState(s),u=n.useState(!0),o=u[0],a=u[1];return n.useEffect(function(){var t;return null!=e.firebaseUser&&(t=f(r,e.firebaseUser.uid,function(e){null!=e&&i(function(t){return t.set(e.id(),e)}),a(!1)})),function(){t&&t()}},[e,r,i]),o}function m(){var e=t.useRecoilValue(s),r=t.useRecoilValue(a);if(null!=r.firebaseUser&&e.has(r.firebaseUser.uid))return e.get(r.firebaseUser.uid)}var b=u.createContext(void 0);e.Authenticate=function(e){var t=e.database,r=l(),n=d(r,t),i=m();return void 0===r.firebaseUser&&r.loading?e.loadingComponent:null===r.firebaseUser&&!1===r.loading?e.authenticationComponent:n&&null==i?e.loadingComponent:null==i?e.userNotAvailableComponent:e.children},e.FirebaseInit=function(e){var t=n.useState(void 0),r=t[0],o=t[1],a=e.firebaseConfig;return n.useLayoutEffect(function(){o(i.initializeApp(a))},[a]),u.createElement(b.Provider,{value:r},null!=r?e.children:e.loadingComponent)},e.authenticationAtom=a,e.createAuthenticationState=o,e.createUser=function(e,t){try{return Promise.resolve(e.collections.users.createDocument(t))}catch(e){return Promise.reject(e)}},e.isAuthenticationState=function(e){return null!=e.loading},e.isMinimalExpectedDatabase=function(e){return null!=e.collections.users},e.isMinimalUserData=function(e){return null!=e.email},e.signIn=function(e,t){try{return Promise.resolve(i.auth().signInWithEmailAndPassword(e,t)).then(function(e){return o({firebaseUser:e.user,loading:!1})})}catch(e){return Promise.reject(e)}},e.signOut=function(){try{return Promise.resolve(i.auth().signOut()).then(function(){return o({loading:!1})})}catch(e){return Promise.reject(e)}},e.signUp=function(e,t){try{return Promise.resolve(i.auth().createUserWithEmailAndPassword(e,t)).then(function(e){return o({firebaseUser:e.user,loading:!1})})}catch(e){return Promise.reject(e)}},e.subscribeForAuthenticatedUser=c,e.subscribeForUser=f,e.updateUser=function(e,t){try{return Promise.resolve(e.collections.users.updateDocument(t))}catch(e){return Promise.reject(e)}},e.useAuthenticatedUser=m,e.useSubscribeForAuthenticatedUser=l,e.useSubscribeForDatabaseUserObject=d,e.usersAtom=s});
//# sourceMappingURL=index.umd.js.map
